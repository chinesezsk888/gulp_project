var isInIosApp=window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.thepaper&&window.webkit.messageHandlers.thepaper.postMessage,isInAndroidApp=window.thepaper&&window.thepaper.newsClicked;function webOnload(t){t&&t.votedList&&t.allVoteInfo&&initUserVote(t.votedList,t.allVoteInfo),imgFactory(function(){sendWebHeight(),initGallery(),askip(),setTimeout(function(){LinkApp.initPage()},200),showimg.initshowimg(),votePK(),ordinaryVote()})}function initGallery(){if(isInAndroidApp){var t=document.querySelectorAll(".table_panel");[].forEach.call(t,function(t,e){var i=t.offsetTop,n=t.offsetTop+t.offsetHeight;window.thepaper.initHorizontalComponent(i,n)})}}function webOnChange(t){var e=t.text_size,i=t.font,n=t.night,a=t.network,o=document.querySelector(".app_new_detail");switch(e){case"0":o.classList.add("fontexsm"),o.classList.remove("fontsm","fontml","fontbig","fontexbig","fontlabig");break;case"1":o.classList.add("fontsm"),o.classList.remove("fontexsm","fontml","fontbig","fontexbig","fontlabig");break;case"2":o.classList.add("fontml"),o.classList.remove("fontexsm","fontsm","fontbig","fontexbig","fontlabig");break;case"3":o.classList.add("fontbig"),o.classList.remove("fontexsm","fontml","fontsm","fontexbig","fontlabig");break;case"4":o.classList.add("fontexbig"),o.classList.remove("fontexsm","fontml","fontbig","fontsm","fontlabig");break;case"5":o.classList.add("fontlabig"),o.classList.remove("fontexsm","fontml","fontbig","fontsm","fontexbig");break;default:console.log("数据不对")}switch(i){case"0":o.classList.add("defultft"),o.classList.remove("songtift");break;case"1":o.classList.add("songtift"),o.classList.remove("defultft");break;default:console.log("数据不对")}switch(n){case"0":o.classList.add("modelbai"),o.classList.remove("modelyj");break;case"1":o.classList.add("modelyj"),o.classList.remove("modelbai");break;default:console.log("数据不对")}switch(a){case"0":o.classList.add("netwifi"),o.classList.remove("netfourg");break;case"1":o.classList.add("netfourg"),o.classList.remove("netwifi")}sendWebHeight(),initGallery(),LinkApp.initChange(),addmadel.inithasclass()}function askip(){var t=document.querySelectorAll(".art_a");[].forEach.call(t,function(e){e.addEventListener("click",function(){var t=getskipinfo(e);LinkApp.sendthepaperToApp(t)})})}function getskipinfo(t){var e=t.getAttribute("data-conttype"),i=t.getAttribute("data-contid"),n=t.getAttribute("data-cid"),a=t.getAttribute("data-optType");return skipmessage={domain:"thepapercn",contType:e,contId:i,cid:n,optType:a},skipmessage=JSON.stringify(skipmessage),skipmessage}function imgFactoryForHeight(){var t=document.querySelectorAll(".img_default"),a=window.screen.width,o=document.querySelectorAll(".app_new_detail")[0].offsetWidth,s=getPadding(document.querySelectorAll(".app_new_detail")[0],"paddingLeft");[].forEach.call(t,function(t){var e=t.getAttribute("data-width"),i=t.getAttribute("data-trueheight"),n=t.getAttribute("data-height");i?(n=(o-s)/(e/i),t.style.width="100%",t.style.height=n+"px"):(n=a/(e/n),t.style.width="100%",t.style.height=n+"px")})}function getPadding(t,e){var i=t.currentStyle?t.currentStyle[e]:getComputedStyle(t,!1)[e];return 2*i.slice(0,i.indexOf("p"))}function imgFactory(t){var e=document.querySelectorAll(".img_default");[].forEach.call(e,function(t){var e=t.getAttribute("data-src");if(e){var i=0;t.src=e,t.onload=function(){t.style.background="rgba(255, 255, 255, 0)"},t.onerror=function(){i<5&&(i++,t.src=e+"?"+100*Math.random())}}}),t&&t()}function sendWebHeight(){var t=document.querySelector(".app_new_detail").scrollHeight;isInAndroidApp&&window.thepaper.contentHeight(t),isInIosApp&&window.webkit.messageHandlers.contentHeight.postMessage(t)}var LinkApp={data:[{name:".and_audio_panel",type:1},{name:".and_video_item",type:2},{name:".ait_item_box",type:3}],initPage:function(){for(var a=this,t=0;t<this.data.length;t++){var o=this.data[t],e=document.querySelectorAll(o.name);[].forEach.call(e,function(e,t){var i=o.type;if("1"==i){e.setAttribute("isupload","1");var n=a.getDataForApp(e,i);a.sendmediaToApp(n),e.style.visibility="hidden"}else"3"==i?e.onclick=function(){this.setAttribute("isupload","0");var t=a.getDataForApp(e,i);a.sendmediaToApp(t)}:e.addEventListener("click",function(){this.setAttribute("data-click","clicked"),this.setAttribute("isupload","0");var t=a.getDataForApp(e,i);a.sendmediaToApp(t)})})}this.initApplink()},initChange:function(){for(var o=this,t=0;t<this.data.length;t++){var s=this.data[t],e=document.querySelectorAll(s.name);[].forEach.call(e,function(e,t){var i=s.type,n=e.getAttribute("data-click");if("1"==i){var a=o.getDataForApp(e,i);o.sendmediaToApp(a)}if("3"==i&&(e.onclick=function(){var t=o.getDataForApp(e,i);o.sendmediaToApp(t)}),n){e.setAttribute("isupload","1");a=o.getDataForApp(e,i);o.sendmediaToApp(a)}})}},initWutu:function(){for(var a=this,t=0;t<this.data.length;t++){var o=this.data[t],e=document.querySelectorAll(o.name);[].forEach.call(e,function(e,t){var i=o.type;if("1"==i){e.setAttribute("isupload","1");var n=a.getDataForApp(e,i);a.sendmediaToApp(n),e.style.visibility="hidden"}"2"==i&&e.addEventListener("click",function(){this.setAttribute("data-click","clicked"),this.setAttribute("isupload","0");var t=a.getDataForApp(e,i);a.sendmediaToApp(t)})})}},getDataForApp:function(t,e){var i=t.getAttribute("data-index"),n=t.getAttribute("isupload"),a={};return a={domain:"thepapercn",mediaType:e||"0",index:i||"0",pos_x:t.offsetLeft||"0",pos_y:t.offsetTop||"0",pos_w:t.offsetWidth||"0",pos_h:t.offsetHeight||"0",isUpdate:n},a=JSON.stringify(a)},initApplink:function(){var o=this,t=document.querySelectorAll(".and_relate");[].forEach.call(t,function(t){var e=t.getAttribute("data-conttype"),i=t.getAttribute("data-contid"),n=t.getAttribute("data-optType"),a=t.getAttribute("data-cid");t.addEventListener("click",function(){var t={domain:"thepapercn",contType:e||"0",contId:i||"0",optType:n||"0",cid:a||"0"};t=JSON.stringify(t),o.sendthepaperToApp(t)})})},sendmediaToApp:function(t){if(isInIosApp)window.webkit.messageHandlers.media.postMessage(t);else if(isInAndroidApp){window.media.newsClicked(t);for(var e=0;e<this.data.length;e++){var i=this.data[e],n=document.querySelectorAll(i.name);[].forEach.call(n,function(t,e){2==i.type&&t.getAttribute("data-click")&&(t.style.visibility="hidden")})}}else console.log(t)},sendthepaperToApp:function(t){isInIosApp?window.webkit.messageHandlers.thepaper.postMessage(t):isInAndroidApp?window.thepaper.newsClicked(t):console.log(t)}},addmadel={data:[{name:".and_video_item"},{name:".ait_item_box"},{name:".anw_img_box"},{name:".ap_item"}],inithasclass:function(){for(var t=document.querySelector(".app_new_detail"),n=this.hasClass(t,"modelyj"),e=0;e<this.data.length;e++){var i=this.data[e],a=document.querySelectorAll(i.name);[].forEach.call(a,function(t,e){var i=t.children[0];n?i.classList.remove("toumin"):i.classList.add("toumin")})}},hasClass:function(t,e){return new RegExp("(^|\\s)"+e+"(\\s|$)").test(t.className)}},showimg={data:[{name:".wutu_type_box"},{name:".wutu_atlas_box"}],initshowimg:function(){for(var t=0;t<this.data.length;t++){var e=this.data[t],i=document.querySelectorAll(e.name);[].forEach.call(i,function(t,e){t.addEventListener("click",function(){t.style.display="none",t.nextElementSibling.style.display="block",sendWebHeight(),initGallery(),LinkApp.initWutu()})})}}};function votePK(){var t=document.querySelectorAll(".aa_word");[].forEach.call(t,function(i,t){i.addEventListener("click",function(){var t=getMsgToApp(i.parentNode.getAttribute("data-vote-id"),i.getAttribute("data-option-id")),e=i.parentNode.parentNode.querySelector(".countvote");e.innerHTML=Number(e.innerHTML)+1,sendMsgToApp(t),voteActive(i,"false")})})}function calculationPk(i,n,a){for(var o=0,s=0,t=document.querySelectorAll(".apvb_pk"),e=[],l=0;l<t.length;l++)e.push(t[l].getAttribute("id"));return e.map(function(t,e){s=(o="true"===a?i/(i+n)*100:(i+1)/(i+1+n)*100,Math.round(o))}),s}function voteActive(t,e){var i=0,n=0,a=50,o=50,s=t.parentNode.parentNode.children[2];if(-1<t.className.indexOf("at_agree_box")){var l=Number(t.getAttribute("data-vote-num")),r=Number(t.nextElementSibling.getAttribute("data-vote-num"));i=calculationPk(l,r,e),n=100-i;var d=t.parentNode.firstElementChild.children[0],c=t.parentNode.firstElementChild.children[1];t.classList.add("aa_isshow"),t.nextElementSibling.classList.add("aa_isshow"),s.classList.add("show"),s.children[1].children[0].classList.add("hide"),c.innerHTML="50%",d.innerHTML="50%",100===i?(c.classList.add("mixzore"),d.style.width=i+"%",c.style.width=n+"%",t.parentNode.firstElementChild.lastElementChild.style.left="98%"):90<i&&i<100?(c.classList.add("mixnine"),d.style.width="inherit",t.parentNode.firstElementChild.lastElementChild.style.left="auto",t.parentNode.firstElementChild.lastElementChild.style.right="0.1rem"):85<i&&i<91?(c.classList.add("mixten"),d.style.width=i+"%",c.style.width=n+"%",t.parentNode.firstElementChild.lastElementChild.style.left=i+"%"):10<=i&&i<15?(d.classList.add("mixten"),d.style.width=i+"%",c.style.width=n+"%",t.parentNode.firstElementChild.lastElementChild.style.left=i+"%"):0<i&&i<10?(d.classList.add("mixnine"),c.style.width="inherit",t.parentNode.firstElementChild.lastElementChild.style.left="0.6rem"):0===i?(d.classList.add("mixzore"),d.style.width=i+"%",c.style.width=n+"%",t.parentNode.firstElementChild.lastElementChild.style.left="2%"):(d.style.width=i+"%",c.style.width=n+"%",t.parentNode.firstElementChild.lastElementChild.style.left=i+"%")}if(-1<t.className.indexOf("at_noagree_box")){l=Number(t.getAttribute("data-vote-num")),r=Number(t.previousElementSibling.getAttribute("data-vote-num"));i=calculationPk(l,r,e),n=100-i;d=t.parentNode.firstElementChild.children[1];(c=t.parentNode.firstElementChild.children[0]).innerHTML="50%",d.innerHTML="50%",t.classList.add("aa_isshow"),t.previousElementSibling.classList.add("aa_isshow"),s.classList.add("show"),s.children[0].children[0].classList.add("hide"),100===i?(c.classList.add("mixzore"),d.style.width=i+"%",c.style.width="0%",t.parentNode.firstElementChild.lastElementChild.style.left="2%"):90<i&&i<100?(c.classList.add("mixnine"),d.style.width="inherit",t.parentNode.firstElementChild.lastElementChild.style.left="0.6rem"):85<i&&i<91?(c.classList.add("mixten"),c.style.width=n+"%",d.style.width=i+"%",t.parentNode.firstElementChild.lastElementChild.style.left=n+"%"):10<=i&&i<15?(d.classList.add("mixten"),c.style.width=n+"%",d.style.width=i+"%",t.parentNode.firstElementChild.lastElementChild.style.left=n+"%"):0<i&&i<10?(d.classList.add("mixnine"),c.style.width="inherit",t.parentNode.firstElementChild.lastElementChild.style.left="auto",t.parentNode.firstElementChild.lastElementChild.style.right="0.1rem"):0===i?(d.classList.add("mixzore"),d.style.width=i+"%",c.style.width=n+"%",t.parentNode.firstElementChild.lastElementChild.style.left="98%"):(c.style.width=n+"%",d.style.width=i+"%",t.parentNode.firstElementChild.lastElementChild.style.left=n+"%")}if(0<=i&&i<=50)var p=setInterval(function(){a-=5,o+=5,d.innerHTML=a+"%",c.innerHTML=o+"%",a<=i&&(clearInterval(p),d.innerHTML=i+"%",c.innerHTML=n+"%")},20);else if(50<i&&i<100)p=setInterval(function(){a+=5,o-=5,d.innerHTML=a+"%",c.innerHTML=o+"%",i<=a&&(clearInterval(p),d.innerHTML=i+"%",c.innerHTML=n+"%")},20);else if(100==i)p=setInterval(function(){a+=5,o-=5,d.innerHTML=a+"%",c.innerHTML=o+"%",i<=a&&(clearInterval(p),d.innerHTML=i+"%",c.innerHTML="")},20)}function ordinaryVote(){var t=document.querySelectorAll(".anb_change_type");[].forEach.call(t,function(n,t){n.addEventListener("click",function(){var a=this,o=[],t=n.parentNode.parentNode,e=t.getAttribute("data-vote-id"),s=n.getAttribute("data-option-id");if(t.className.indexOf("hasclick")<=-1){var i=t.parentNode.querySelector(".countvote");i.innerHTML=Number(i.innerHTML)+1,sendMsgToApp(getMsgToApp(e,s))}var l=t.querySelectorAll("ul .anb_change_type");[].forEach.call(l,function(t,e){var i=a;if(""==t.children[2].innerHTML){i.classList.add("vote_changed"),i.parentNode.parentNode.classList.add("hasclick");var n=i.parentNode.parentNode.parentNode;o.push(t.getAttribute("data-vote-num")),e==l.length-1&&ordinaryVoteActive(ordinaryVoteMix(o,l,s,"false"),n)}})})})}function compare(i){return function(t,e){return t[i]-e[i]}}function ordinaryVoteMix(t,o,s,l){var r=0,d=0,c=0,p=[],u=[];return t.map(function(t,e){r+=Number(t)}),"false"===l&&(r+=1),[].forEach.call(o,function(t,e){var i=Number(t.getAttribute("data-option-id")),n=Number(t.getAttribute("data-vote-num"));"false"===l&&i==Number(s)&&(n+=1);var a={id:i,number:n};p.push(a),e==o.length-1&&(p.sort(compare("number")),p.map(function(t,e){if(e<p.length-1){var i=t.number;c=Math.ceil(i/r*100),d=c+d;var n={id:t.id,mix:c+"%"};u.push(n)}if(e==p.length-1){c=100-d;n={id:t.id,mix:c+"%"};u.push(n)}}))}),u}function ordinaryVoteActive(t,e){var i=e.querySelectorAll(".anb_change_type"),s=0;t.forEach(function(o,t){[].forEach.call(i,function(t,e){var i=t.getAttribute("data-option-id"),n=o.mix.slice(0,-1);if(i==o.id){t.children[1].style.width=o.mix;var a=setInterval(function(){s+=3,t.children[2].innerHTML=s+"%",n<=s&&(clearInterval(a),t.children[2].innerHTML=o.mix)},20)}})})}function getMsgToApp(t,e){return result={domain:"thepapercn",vote_id:t,option_id:e},result=JSON.stringify(result),result}function sendMsgToApp(t){isInAndroidApp&&window.thepaper.voteInfo(t),isInIosApp&&window.webkit.messageHandlers.voteInfo.postMessage(t)}function andrionFontSize(){isInAndroidApp&&document.querySelector(".app_new_detail").classList.add("andrionpage"),isInIosApp&&document.querySelector(".app_new_detail").classList.add("iospage")}function initUserVote(s,t){var l=[];t.map(function(t,e){var a=t.optionList,o=t.voteId,i=t.voteNum,n=document.getElementById(o);n.parentNode.querySelector(".countvote").innerHTML=i,n&&getoptionNum(n,a),s.map(function(i,n){i.vote_id==o&&a.map(function(t,e){t.optionId==i.option_id&&"0"==t.voteCount&&(l.push(i),s.splice(n,1))})})}),l.map(function(t,e){initVu(t.vote_id,t.option_id,"false")}),s.map(function(t,e){initVu(t.vote_id,t.option_id,"true")})}function initVu(t,e,i){var n=document.getElementById(t);if(n){if(-1<n.className.indexOf("apvb_pk")){if("false"===i)(a=n.parentNode.querySelector(".countvote")).innerHTML=Number(a.innerHTML)+1;initPk(n,e,i)}if(-1<n.className.indexOf("anvb_normall_box")){var a;if(n.classList.add("hasclick"),"false"===i)(a=n.parentNode.querySelector(".countvote")).innerHTML=Number(a.innerHTML)+1;initNormall(n,e,i)}}}function initPk(t,i,n){var e=t.querySelectorAll(".aa_word");[].forEach.call(e,function(t,e){t.getAttribute("data-option-id")==i&&voteActive(t,n)})}function initNormall(t,i,n){var a=[],o=t.querySelectorAll(".anb_change_type");[].forEach.call(o,function(t,e){a.push(t.getAttribute("data-vote-num")),t.getAttribute("data-option-id")==i&&t.classList.add("vote_changed"),e==o.length-1&&ordinaryVoteActive(ordinaryVoteMix(a,o,i,n),t.parentNode)})}function getoptionNum(t,e){if(-1<t.className.indexOf("apvb_pk"))var a=t.querySelectorAll(".aa_word");if(-1<t.className.indexOf("anvb_normall_box"))a=t.querySelectorAll(".anb_change_type");e.map(function(t,e){var i=t.optionId,n=t.voteCount;[].forEach.call(a,function(t,e){t.getAttribute("data-option-id")==i&&t.setAttribute("data-vote-num",n)})})}window.onload=function(){andrionFontSize(),imgFactoryForHeight(),addmadel.inithasclass(),webOnload()};